<!-- app/templates/veiculos/index.html -->
{% extends "base.html" %}
{% block title %}Veículos{% endblock %}
{% block content %}
<h1>Gerenciar Veículos</h1>
<form method="POST" action="{{ url_for('veiculos.listar_veiculos') }}" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.id_fornecedor.label }} {{ form.id_fornecedor(class="form-control") }}
        {% for error in form.id_fornecedor.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        {{ form.placa.label }} {{ form.placa(class="form-control") }}
        {% for error in form.placa.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        {{ form.ativo.label }} {{ form.ativo(class="form-control") }}
        {% for error in form.ativo.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        {{ form.status.label }} {{ form.status(class="form-control") }}
        {% for error in form.status.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        {{ form.foto1.label }} {{ form.foto1(class="form-control-file") }}
        {% for error in form.foto1.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        {{ form.foto2.label }} {{ form.foto2(class="form-control-file") }}
        {% for error in form.foto2.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    {{ form.submit(class="btn btn-primary") }}
</form>
<h2 class="mt-4">Lista de Veículos</h2>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Fornecedor</th>
            <th>Placa</th>
            <th>Ativo</th>
            <th>Status</th>
            <th>Sequencial</th>
            <th>Foto 1</th>
            <th>Foto 2</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for veiculo in veiculos %}
            <tr>
                <td>{{ veiculo.id }}</td>
                <td>
                    {{ get_fornecedor(veiculo.id_fornecedor).nome if get_fornecedor(veiculo.id_fornecedor) else 'Desconhecido' }}
                </td>
                <td>{{ veiculo.placa }}</td>
                <td>{{ veiculo.ativo }}</td>
                <td>{{ veiculo.status }}</td>
                <td>{{ veiculo.sequencial }}</td>
                <td>
                    {% if veiculo.foto1 %}
                        <img src="{{ url_for('static', filename='uploads/veiculos/' + veiculo.foto1) }}" alt="Foto 1 do veículo" style="max-width: 100px;">
                    {% else %}
                        Sem foto
                    {% endif %}
                </td>
                <td>
                    {% if veiculo.foto2 %}
                        <img src="{{ url_for('static', filename='uploads/veiculos/' + veiculo.foto2) }}" alt="Foto 2 do veículo" style="max-width: 100px;">
                    {% else %}
                        Sem foto
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('veiculos.editar_veiculo', id=veiculo.id) }}" class="btn btn-sm btn-warning">Editar</a>
                    <form action="{{ url_for('veiculos.deletar_veiculo', id=veiculo.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Tem certeza que deseja deletar este veículo?');">Deletar</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% macro get_fornecedor(id) %}
    {% for fornecedor in g.fornecedores %}
        {% if fornecedor.id == id %}
            {{ fornecedor }}
        {% endif %}
    {% endfor %}
{% endmacro %}